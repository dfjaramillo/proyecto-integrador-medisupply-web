<div class="cargue-masivo-dialog">
  <div class="dialog-header">
    <h2 i18n="@@inventory.bulkUploadDialog.title">Cargue masivo</h2>
    <button
      mat-icon-button
      class="close-btn"
      (click)="onCancel()"
      type="button"
      i18n-aria-label="@@inventory.bulkUploadDialog.closeAria" aria-label="Cerrar formulario de cargue masivo"
    >
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <div class="content-section">
      <!-- Paso 1: Descargar plantilla -->
      <div class="step-section">
        <p class="step-label" i18n="@@inventory.bulkUploadDialog.step1">1. Obt√©n la plantilla que debes diligenciar</p>
        <button
          mat-raised-button
          class="download-btn"
          (click)="downloadTemplate()"
          type="button"
        >
          <mat-icon>download</mat-icon>
          <span i18n="@@inventory.bulkUploadDialog.downloadTemplateBtn">Descargar plantilla</span>
        </button>
      </div>

      <!-- Paso 2: Cargar archivo -->
      <div class="step-section">
        <p class="step-label" i18n="@@inventory.bulkUploadDialog.step2">2. Sube el archivo a la plataforma</p>
        
        @if (!selectedFile) {
        <button
          mat-raised-button
          class="upload-btn"
          (click)="fileInput.click()"
          type="button"
        >
          <mat-icon>upload</mat-icon>
          <span i18n="@@inventory.bulkUploadDialog.uploadTemplateBtn">Cargar plantilla</span>
        </button>
        <input
          #fileInput
          type="file"
          accept=".csv,.xlsx,.xls"
          (change)="onFileSelected($event)"
          style="display: none"
          i18n-aria-label="@@inventory.bulkUploadDialog.selectFileAria" aria-label="Seleccionar archivo"
        />
        }

        @if (selectedFile) {
        <div class="file-info-box">
          <div class="file-details">
            <span class="file-name">{{ selectedFile.name }}</span>
            <span class="file-size">| {{ formatFileSize(selectedFile.size) }}</span>
          </div>
          <button
            mat-icon-button
            class="remove-file-btn"
            (click)="removeFile()"
            type="button"
            i18n-aria-label="@@inventory.bulkUploadDialog.removeFileAria" aria-label="Eliminar archivo seleccionado"
            i18n-title="@@inventory.bulkUploadDialog.removeFileTitle" title="Eliminar archivo"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
        }

        @if (uploadError()) {
        <div class="error-message" role="alert">{{ uploadError() }}</div>
        }

        @if (successMessage()) {
        <div class="success-message" role="alert">{{ successMessage() }}</div>
        }
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions>
    <button
      mat-raised-button
      type="button"
      class="submit-btn"
      [disabled]="!selectedFile || loading()"
      (click)="onSubmit()"
      [attr.aria-busy]="loading()"
    >
      @if (!loading()) { <span i18n="@@inventory.bulkUploadDialog.saveButton">Guardar</span> } @else {
      <mat-spinner diameter="20" aria-hidden="true"></mat-spinner>
      <span class="sr-only" i18n="@@inventory.bulkUploadDialog.savingSr">Cargando archivo...</span>
      }
    </button>
  </mat-dialog-actions>
</div>
