<div class="create-route-dialog">
  <div class="dialog-header">
    <h2 i18n="@@routes.createRouteDialog.title">Crear ruta</h2>
    <button
      mat-icon-button
      class="close-btn"
      (click)="onCancel()"
      [disabled]="loading()"
      i18n-aria-label="@@routes.createRouteDialog.closeAria" aria-label="Cerrar formulario de crear ruta"
    >
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <form [formGroup]="routeForm" (ngSubmit)="onSubmit()">
      <!-- Camión -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label i18n="@@routes.createRouteDialog.truckLabel">Camión</mat-label>
        <mat-select
          formControlName="assigned_truck"
          placeholder="Seleccione un camión" i18n-placeholder="@@routes.createRouteDialog.truckPlaceholder"
          [disabled]="loading() || loadingTrucks()"
          (selectionChange)="validateTruckAvailability()"
          aria-required="true"
        >
          <mat-option *ngFor="let truck of trucks()" [value]="truck.plate">
            {{ truck.label }}
          </mat-option>
        </mat-select>
        @if (routeForm.get('assigned_truck')?.touched && routeForm.get('assigned_truck')?.hasError('required')) {
        <mat-error role="alert">{{ getErrorMessage('assigned_truck') }}</mat-error>
        }
        @if (routeForm.get('assigned_truck')?.hasError('truckUnavailable')) {
        <mat-error role="alert">{{ getErrorMessage('assigned_truck') }}</mat-error>
        }
        @if (loadingTrucks()) {
        <mat-hint>Cargando camiones...</mat-hint>
        }
      </mat-form-field>

      <!-- Tipo de productos -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label i18n="@@routes.createRouteDialog.productTypeLabel">Tipo de productos</mat-label>
        <mat-select
          formControlName="product_type"
          placeholder="Seleccione el tipo de productos" i18n-placeholder="@@routes.createRouteDialog.productTypePlaceholder"
          [disabled]="loading()"
          aria-required="true"
        >
          <mat-option *ngFor="let type of productTypes" [value]="type">
            {{ type }}
          </mat-option>
        </mat-select>
        @if (routeForm.get('product_type')?.touched && routeForm.get('product_type')?.hasError('required')) {
        <mat-error role="alert">{{ getErrorMessage('product_type') }}</mat-error>
        }
      </mat-form-field>

      <!-- Fecha de entrega -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label i18n="@@routes.createRouteDialog.deliveryDateLabel">Fecha de entrega</mat-label>
        <input
          matInput
          [matDatepicker]="datePicker"
          formControlName="delivery_date"
          placeholder="DD/MM/AAAA" i18n-placeholder="@@routes.createRouteDialog.deliveryDatePlaceholder"
          [min]="minDate"
          [disabled]="loading()"
          (dateChange)="validateTruckAvailability()"
          aria-required="true"
        />
        <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
        <mat-datepicker #datePicker></mat-datepicker>
        @if (routeForm.get('delivery_date')?.touched && routeForm.get('delivery_date')?.hasError('required')) {
        <mat-error role="alert">{{ getErrorMessage('delivery_date') }}</mat-error>
        }
        @if (routeForm.get('delivery_date')?.hasError('futureDate')) {
        <mat-error role="alert">{{ getErrorMessage('delivery_date') }}</mat-error>
        }
      </mat-form-field>

    </form>
  </mat-dialog-content>

  <mat-dialog-actions>
    <div class="dialog-actions">    
      <button
        mat-raised-button
        type="submit"
        class="submit-btn"
        (click)="onSubmit()"
        [disabled]="loading() || routeForm.invalid"
        i18n-aria-label="@@routes.createRouteDialog.generateAria" aria-label="Generar ruta"
      >
        @if (loading()) {
        <mat-spinner diameter="20"></mat-spinner>
        <span i18n="@@routes.createRouteDialog.generating">Generando...</span>
        } @else {
        <span i18n="@@routes.createRouteDialog.generateBtn">Generar ruta</span>
        }
      </button>
    </div>
  </mat-dialog-actions>
</div>
